<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MM Courier | Login</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Leaflet (background map only) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import {
    getAuth,
    GoogleAuthProvider,
    signInWithPopup,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkTejW8c3kAkEr0m3fdPxHKjWr01Q8VBQ",
    authDomain: "route-planner-5cadb.firebaseapp.com",
    projectId: "route-planner-5cadb",
    storageBucket: "route-planner-5cadb.firebasestorage.app",
    messagingSenderId: "893421996060",
    appId: "1:893421996060:web:e6c7b0b6c2c1481cf5b7d9",
    measurementId: "G-E1X6VWXCQE"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Redirect if already logged in
  onAuthStateChanged(auth, user => {
    if (user) window.location.href = "/index.html";
  });

  window.authActions = {
    login: (email, password) =>
      signInWithEmailAndPassword(auth, email, password),

    signup: (email, password) =>
      createUserWithEmailAndPassword(auth, email, password),

    google: () =>
      signInWithPopup(auth, provider)
  };
</script>

<style>
  body { margin:0; overflow:hidden; }
  #map { position:fixed; inset:0; z-index:0; }
</style>
</head>

<body>

<!-- Background map -->
<div id="map"></div>

<!-- Overlay -->
<div class="fixed inset-0 bg-black/40 z-10"></div>

<!-- Auth card -->
<div class="relative z-20 min-h-screen flex items-center justify-center px-4">

  <div class="w-full max-w-md bg-white rounded-xl shadow-xl p-6">

    <h1 class="text-2xl font-bold text-center mb-1">
      MM Courier Route Planner
    </h1>
    <p class="text-center text-sm text-gray-500 mb-6">
      Smarter delivery routing
    </p>

    <!-- Toggle -->
    <div class="flex mb-5 border rounded-lg overflow-hidden">
      <button id="loginTab"
        class="flex-1 py-2 font-semibold bg-blue-600 text-white">
        Login
      </button>
      <button id="signupTab"
        class="flex-1 py-2 font-semibold bg-gray-100 text-gray-700">
        Create Account
      </button>
    </div>

    <!-- Form -->
    <form id="authForm" class="space-y-4">
      <div>
        <label class="text-sm font-medium text-gray-600">Email</label>
        <input id="email" type="email" required
          class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-blue-500" />
      </div>

      <div>
        <label class="text-sm font-medium text-gray-600">Password</label>
        <input id="password" type="password" required
          class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-blue-500" />
      </div>

      <button type="submit"
        class="w-full bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700">
        Login
      </button>
    </form>

    <!-- Google -->
    <button id="googleBtn"
      class="w-full mt-4 border py-2 rounded font-semibold hover:bg-gray-50">
      Continue with Google
    </button>

    <p id="error" class="text-red-600 text-sm mt-4 hidden"></p>

    <p class="text-xs text-gray-500 mt-6 text-center">
      Free tier: up to 10 stops per route
    </p>
  </div>
</div>

<script>
/* ---------- BACKGROUND MAP ---------- */
const map = L.map("map", {
  zoomControl:false,
  attributionControl:false
}).setView([-26.2041, 28.0473], 11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

/* ---------- AUTH UI ---------- */
let mode = "login";

const loginTab = document.getElementById("loginTab");
const signupTab = document.getElementById("signupTab");
const form = document.getElementById("authForm");
const errorBox = document.getElementById("error");
const submitBtn = form.querySelector("button");

loginTab.onclick = () => setMode("login");
signupTab.onclick = () => setMode("signup");

function setMode(m){
  mode = m;
  if(m === "login"){
    loginTab.className = "flex-1 py-2 font-semibold bg-blue-600 text-white";
    signupTab.className = "flex-1 py-2 font-semibold bg-gray-100 text-gray-700";
    submitBtn.textContent = "Login";
  } else {
    signupTab.className = "flex-1 py-2 font-semibold bg-blue-600 text-white";
    loginTab.className = "flex-1 py-2 font-semibold bg-gray-100 text-gray-700";
    submitBtn.textContent = "Create Account";
  }
}

form.onsubmit = async (e) => {
  e.preventDefault();
  errorBox.classList.add("hidden");

  const email = email.value;
  const password = password.value;

  try {
    if (mode === "login") {
      await window.authActions.login(email, password);
    } else {
      await window.authActions.signup(email, password);
    }
  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.classList.remove("hidden");
  }
};

document.getElementById("googleBtn").onclick = async () => {
  try {
    await window.authActions.google();
  } catch (err) {
    errorBox.textContent = err.message;
    errorBox.classList.remove("hidden");
  }
};
</script>

</body>
</html>